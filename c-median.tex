\begin{frame}
  \begin{center}
    \LARGE <<Медианный горный хребет>>
  \end{center}

\begin{center}
	\includegraphics[width=5cm]{memes/c-meme.jpg}
\end{center}

  \begin{itemize}
  \item Идея задачи --- Никита Сендерович
  \item Разработка задачи --- Филипп Грибов
  \end{itemize}

\end{frame}

\begin{frame}{Постановка задачи}

  \begin{itemize}
  \item Дан массив из $n$ чисел, каждое не превышает $a$.
  \item За одну итерацию каждое число массива меняется на медиану из него и двух его окружающих.
  \item Требуется найти значение $c$~--- через сколько итераций числа в массиве перестанут меняться.
  \item Так же надо получить числа массива после $c$ итераций.
  \end{itemize}
  
\end{frame}

\begin{frame}{Решение за $\O(n \cdot c)$ (19 баллов)}
  \begin{itemize}
  \item Будем симулировать процесс, за $\O(n)$ производя по одной итерации.
  \item Так делаем пока массив меняется при очередной итерации.
  \item Так как гарантируется, что $c$ не превышает $10\,000$, то ограничения по времени позволяют это сделать.
  \end{itemize}
\end{frame}

\begin{frame}{Числа не превышают $2$ (24 балла)}
  \begin{itemize}
  \item Если два одинаковых числа стоят подряд в массиве, то они меняться не будут.
  \item Тогда меняться могут только числа внутри отрезков из чередующихся $1$ и $2$.
  \item За одну итерацию концы таких отрезков останутся неизменными, а все числа внутри заменятся на противоположные.
  \item При этом числа рядом с концами отрезков станут равными концам отрезков и в будущем меняться не будут.
  \end{itemize}
\end{frame}

\begin{frame}{Числа не превышают $2$ (24 балла)}
  \begin{itemize}
  \item Итого за одну итерацию длины всех отрезков из чередующихся $1$ и $2$ уменьшаются на $2$.
  \item Тогда общее число итераций равно длине максимального отрезка делённой на $2$.
  \item После всех итераций все числа в левой половине отрезка станут равны левому концу отрезка, а в правой половине~--- правому.
  \end{itemize}

  \begin{center}
    \newcommand{\One} {\textcolor{Orange}{1}}
    \newcommand{\Two} {\textcolor{Magenta}{2}}
    
    \begin{tabular}{cc}
      \textcolor{blue}{11}\Two\One\Two\One\Two\textcolor{blue}{111} & \textcolor{blue}{11}\Two\One\Two\One\textcolor{blue}{22} \\
      \textcolor{blue}{111}\Two\One\Two\textcolor{blue}{1111} & \textcolor{blue}{111}\Two\One\textcolor{blue}{222} \\
      \textcolor{blue}{1111}\Two\textcolor{blue}{11111} & \textcolor{blue}{11112222} \\
      \textcolor{blue}{1111111111} &   \\
  \end{tabular}
  \end{center}
  
\end{frame}

\begin{frame}{Решение за $\O(n \cdot a)$ ($14 + 38$ баллов)}
  \begin{itemize}
  \item Заффиксируем некоторое число $x$ и заменим числа, $< x$, на $1$, а числа $\ge x$ на $2$.
  %% \item Тогда если применить к исходному массиву одну итерацию, и потом заменить на $1$ и $2$ по тому же принципу, получится новый массив с применённой итерацией.
    %% \item Для нового массива мы знаем через сколько итераций он меняться перестанет. Ровно через это количество итераций числа, меньшие $x$, навсегда останутся меньше $x$, а остальные навсегда останутся больше или равны $x$.
  \item Тогда если решить задачу для этого массива, то число $1$ будет означать, что в исходной версии
    в этом месте будет число $< x$, а $2$, что число $\ge x$.
  \end{itemize}
\end{frame}

\begin{frame}{Решение за $\O(n \cdot a)$ ($14 + 38$ баллов)}
  \begin{itemize}
  \item Переберём все возможные $x$ от $1$ до $a$.
  \item Заменим на массив из $1$ и $2$ (по тому же принципу) и посчитаем число итераций, после которых новый массив перестанет меняться.
  \item Максимальное из этих количеств итераций по всем $x$ и будет $c$.
  \item Итого асимптотика $\O(n \cdot a)$.
  \item Чтобы восстановить массив достаточно для каждого элемента массива найти самый большой $x$, что симуляция с этим $x$ всё ещё приводит к ``2''.
  \end{itemize}
\end{frame}

%% \begin{frame}{Решение за $\O(n \cdot a)$ ($14 + 38$ баллов)}
%%   \begin{itemize}
%%   \item Возьмём $x = a$.
%%   \item Заменим числа, меньшие $x$, на $1$, а остальные на $2$.
%%   \item Для нового массива мы знаем, на каких позициях в конце стоит $2$.
%%   \item На этих же позициях в исходном массиве в конце стоят числа, равные $a$.
%%   \end{itemize}
%% \end{frame}

%% \begin{frame}{Решение за $\O(n \cdot a)$ ($14 + 38$ баллов)}
%%   \begin{itemize}
%%   \item Возьмём $x = a - 1$.
%%   \item Аналогично предыдущему поймём, на каком множестве позиций в конце стоят числа, большие или равные $a - 1$.
%%   \item Мы знаем на каких позициях стоят числа, равные $a$.
%%   \item Тогда на всех остальных позициях этого множества будут стоять числа, равные $a - 1$.
%%   \end{itemize}
%% \end{frame}

%% \begin{frame}{Решение за $\O(n \cdot a)$ ($14 + 38$ баллов)}
%%   \begin{itemize}
%%   \item Аналогичные образом поймём на каких позициях стоят числа $a - 2, a - 3, \ldots, 1$.
%%   \item Так получим массив после $c$ итераций.
%%   \item Восстановление позиций одного числа работает за $\O(n)$.
%%   \item Итого асимптотика $\O(n \cdot a)$.
%%   \end{itemize}
%% \end{frame}

%% \begin{frame}{Нахождение $c$ ($28$ баллов)}
%%   \begin{itemize}
%%   \item Из предыдущих слайдов мы знаем, что чтобы найти $c$, можно перебрать все возможные $x$ от $1$ до $a$
%%   \item При каждом $x$ заменить все числа, меньшие $x$, на $1$, а остальные на $2$.
%%   \item В таких новых массивах взять максимальное число итераций, при которых происходят изменения.
%%   \item То есть во всех таких массивах найти самый длинный отрезок из чередующихся $1$ и $2$ и разделить его длину на $2$.
%%   \end{itemize}
%% \end{frame}

\begin{frame}{Нахождение $c$ ($+14$ баллов)}
  \begin{itemize}
  \item Нетрудно показать, что стоит рассматривать только те $x$, которые равны числам массива.
  \item Хотим понять сколько максимум итераций понадобится. Но число итераций при конкретном $x$ равно 0.5 длины
    самого длинного чередующегося отрезка.
  \item Отсортируем все числа массива и будем рассматривать их как $x$ в порядке убывания.
  \item Изначально сделаем $x$ равным \t{max} числу массива и заведём массив из $1$ и $2$.
  \item Далее будем постепенно уменьшать $x$ и пересчитывать $1-2$-отрезки.
  \end{itemize}
\end{frame}

\begin{frame}{Нахождение $c$ ($+14$ баллов)}
  \begin{itemize}
  \item Будем хранить все чередующиеся $1-2$-отрезки в \t{set}.
  \item Как этот \t{set} меняется при уменьшении $x$? Предположим на некоторой позиции $p$ нужно заменить $1 \to 2$.
  \item В случае, если на позиции $p - 1$ находится $1$, нужно объединить отрезок с $p$ с отрезком слева, содержащим $p - 1$.
  \item В противном случае нужно наоборот разделить этот отрезок по позиции $p$.
  \item Аналогично с позицией $p + 1$.
  \end{itemize}
\end{frame}

\begin{frame}{Нахождение $c$ ($+14$ баллов)}
  \begin{itemize}
  \item Так как все отрезки хранятся в $set$, то создание или удаление отрезков работает за $\O(\log n)$.
  \item Так как на каждой позиции изменение $1$ на $2$ происходит ровно один раз, то асимптотика $\O(n \log n)$.
  \item После того как пересчитали отрезки для нового $x$, пересчитываем ответ относительно новых длин.
  \item Нам осталось только получить сам массив после $c$ итераций.
  \end{itemize} 
\end{frame}

\begin{frame}{Полное решение (100 баллов)}
  \begin{itemize}
  \item Будем так же уменьшать $x$ и пересчитывать отрезки из чередующихся $1$ и $2$.
  \item Будем в \t{set} хранить позиции, на которых числа в итоговом массиве пока не известны.
  \item После рассмотрения очередного $x$ научимся понимать, на каких позициях будут стоять числа, равные $x$.
  \item Это те позиции, в которых после $c$ итераций написано $2$ и они ещё не удалены из \t{set}
  \end{itemize}
\end{frame}

%%%

\begin{frame}{Полное решение (100 баллов)}
  \begin{itemize}
  \item После уменьшения $x$ некоторые отрезки останутся прежними, а некоторые изменятся.
  \item На отрезках, которые останутся прежними, не могут появиться новые позиции, про числа на которых мы раньше не знали.
  \item Для каждого изменившегося отрезка поймём во что они превратятся, исходя из их длин и чисел по краям.
  \item Если этот изменившийся отрезок порождает какой-то отрезок с двойками, то извлечём из \t{set} все ещё не удалённые элементы и запишем для них ответ.
  \end{itemize}
\end{frame}

\begin{frame}{Полное решение (100 баллов)}
  \begin{itemize}
  \item Получилось решение за $\O(n \log n)$, можно решить задачу за $\O(n)$.
  \end{itemize}
\end{frame}

%% \begin{frame}{Полное решение (100 баллов)}
%%   \begin{itemize}
%%   \item Для отрезка из чередующихся $1$ и $2$ в конце $2$ будут стоять на некотором подотрезке.
%%   \item Для изменившегося отрезка из $1$ и $2$ найдём такой подотрезок.
%%   \item На этом подотрезке посмотрим на все позиции, про которых числа в итоговом массиве пока не известны.
%%   \item Теперь известны, на них стоит $x$.
%%   \end{itemize}
%% \end{frame}

%% \begin{frame}{Полное решение (100 баллов)}
%%   \begin{itemize}
%%   \item Для каждой позиции она не более одного раза входит в такой подотрезок, после чего навсегда удаляется из $set$.
%%   \item Тогда итоговая асимптотика $\O(n \log n)$.
%%   \item Существует так же решение за $\O(n)$.
%%   \end{itemize}
%% \end{frame}
